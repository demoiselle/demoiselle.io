<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Capítulo 6. Exemplos de Uso</title><link rel="stylesheet" href="css/demoiselleframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Demoiselle Signer"/><link rel="up" href="policy-impl-cades-master.html" title="Parte II. Implementação das Políticas CAdES"/><link rel="prev" href="policy-impl-cades-funcionalidades.html" title="Capítulo 5. Funcionalidades"/><link rel="next" href="policy-engine-master.html" title="Parte III. Policy Engine"/><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p id="title"><a href="http://www.frameworkdemoiselle.gov.br" class="site_href"><strong>FrameworkDemoiselle.gov.br</strong></a><a href="http://www.frameworkdemoiselle.gov.br" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="policy-impl-cades-funcionalidades.html"><strong>Anterior</strong></a></li><li class="next"><a accesskey="n" href="policy-engine-master.html"><strong>Próxima</strong></a></li></ul><div class="chapter" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="policy-impl-cades-exemplos"/>Capítulo 6. Exemplos de Uso</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1233">6.1. Carregar um array de bytes de um arquivo</a></span></dt><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1238">6.2. Gravar um array de bytes em um arquivo</a></span></dt><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1243">6.3. Carregar uma chave privada em arquivo</a></span></dt><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1248">6.4. Carregar uma chave privada de um token</a></span></dt><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1253">6.5. Carregar uma chave pública em arquivo</a></span></dt><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1258">6.6. Carregar uma chave pública de um token</a></span></dt><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1263">6.7. Carregar um certificado digital de um arquivo</a></span></dt><dt><span class="section"><a href="policy-impl-cades-exemplos.html#d0e1268">6.8. Carregar um certificado digital de um token</a></span></dt></dl></div><p>
		A seguir temos alguns exemplos de tarefas normalmente necessárias na utilização do componente.
	</p><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1233"/>6.1. Carregar um array de bytes de um arquivo</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">File</span><span class="java_plain">&nbsp;file&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">File</span><span class="java_separator">(</span><span class="java_literal">&quot;documento.odp&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">FileInputStream</span><span class="java_plain">&nbsp;is&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FileInputStream</span><span class="java_separator">(</span><span class="java_plain">file</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[(</span><span class="java_type">int</span><span class="java_separator">)</span><span class="java_plain">&nbsp;file</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()];</span>
<!--  --><br/><span class="java_plain">is</span><span class="java_separator">.</span><span class="java_plain">read</span><span class="java_separator">(</span><span class="java_plain">result</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">is</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">return</span><span class="java_plain">&nbsp;result</span><span class="java_separator">;</span></pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1238"/>6.2. Gravar um array de bytes em um arquivo</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;conteudo&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;este&nbsp;eh&nbsp;um&nbsp;conteudo&nbsp;de&nbsp;arquivo&nbsp;texto&quot;</span><span class="java_separator">.</span><span class="java_plain">getBytes</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FileOutputStream</span><span class="java_plain">&nbsp;out&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FileOutputStream</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">File</span><span class="java_separator">(</span><span class="java_literal">&quot;arquivo.txt&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">write</span><span class="java_separator">(</span><span class="java_plain">sign</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1243"/>6.3. Carregar uma chave privada em arquivo</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">File</span><span class="java_plain">&nbsp;file&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">File</span><span class="java_separator">(</span><span class="java_literal">&quot;private_rsa_1024.pkcs8&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fileContent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[(</span><span class="java_type">int</span><span class="java_separator">)</span><span class="java_plain">&nbsp;file</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()];</span>
<!--  --><br/><span class="java_plain">is&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FileInputStream</span><span class="java_separator">(</span><span class="java_plain">file</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">is</span><span class="java_separator">.</span><span class="java_plain">read</span><span class="java_separator">(</span><span class="java_plain">fileContent</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">is</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">PKCS8EncodedKeySpec</span><span class="java_plain">&nbsp;privateKeySpec&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PKCS8EncodedKeySpec</span><span class="java_separator">(</span><span class="java_plain">fileContent</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KeyFactory</span><span class="java_plain">&nbsp;keyFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KeyFactory</span><span class="java_separator">.</span><span class="java_plain">getInstance</span><span class="java_separator">(</span><span class="java_literal">&quot;RSA&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">PrivateKey</span><span class="java_plain">&nbsp;chavePrivada&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;keyFactory</span><span class="java_separator">.</span><span class="java_plain">generatePrivate</span><span class="java_separator">(</span><span class="java_plain">privateKeySpec</span><span class="java_separator">);</span></pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1248"/>6.4. Carregar uma chave privada de um token</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KeyStoreLoader</span><span class="java_plain">&nbsp;keyStoreLoader&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KeyStoreLoaderFactory</span><span class="java_separator">.</span><span class="java_plain">factoryKeyStoreLoader</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">KeyStore</span><span class="java_plain">&nbsp;keyStore&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;keyStoreLoader</span><span class="java_separator">.</span><span class="java_plain">getKeyStore</span><span class="java_separator">(</span><span class="java_literal">&quot;pinnumber&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;certificateAlias&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;keyStore</span><span class="java_separator">.</span><span class="java_plain">aliases</span><span class="java_separator">().</span><span class="java_plain">nextElement</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">PrivateKey</span><span class="java_plain">&nbsp;chavePrivada&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">PrivateKey</span><span class="java_separator">)</span><span class="java_plain">keyStore</span><span class="java_separator">.</span><span class="java_plain">getKey</span><span class="java_separator">(</span><span class="java_plain">certificateAlias</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;pinnumber&quot;</span><span class="java_separator">);</span></pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1253"/>6.5. Carregar uma chave pública em arquivo</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">File</span><span class="java_plain">&nbsp;file&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">File</span><span class="java_separator">(</span><span class="java_literal">&quot;public_rsa_1024.pkcs8&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;fileContent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[(</span><span class="java_type">int</span><span class="java_separator">)</span><span class="java_plain">&nbsp;file</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()];</span>
<!--  --><br/><span class="java_plain">is&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FileInputStream</span><span class="java_separator">(</span><span class="java_plain">file</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">is</span><span class="java_separator">.</span><span class="java_plain">read</span><span class="java_separator">(</span><span class="java_plain">fileContent</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">is</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">X509EncodedKeySpec</span><span class="java_plain">&nbsp;publicKeySpec&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">X509EncodedKeySpec</span><span class="java_separator">(</span><span class="java_plain">fileContent</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KeyFactory</span><span class="java_plain">&nbsp;keyFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KeyFactory</span><span class="java_separator">.</span><span class="java_plain">getInstance</span><span class="java_separator">(</span><span class="java_literal">&quot;RSA&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">PublicKey</span><span class="java_plain">&nbsp;chavePublica&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;keyFactory</span><span class="java_separator">.</span><span class="java_plain">generatePublic</span><span class="java_separator">(</span><span class="java_plain">publicKeySpec</span><span class="java_separator">);</span></pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1258"/>6.6. Carregar uma chave pública de um token</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KeyStoreLoader</span><span class="java_plain">&nbsp;keyStoreLoader&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KeyStoreLoaderFactory</span><span class="java_separator">.</span><span class="java_plain">factoryKeyStoreLoader</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">KeyStore</span><span class="java_plain">&nbsp;keyStore&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;keyStoreLoader</span><span class="java_separator">.</span><span class="java_plain">getKeyStore</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">CertificateLoader</span><span class="java_plain">&nbsp;certificateLoader&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CertificateLoader</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">certificateLoader</span><span class="java_separator">.</span><span class="java_plain">setKeyStore</span><span class="java_separator">(</span><span class="java_plain">keyStore</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">X509Certificate</span><span class="java_plain">&nbsp;certificate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;certificateLoader</span><span class="java_separator">.</span><span class="java_plain">loadFromToken</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">PublicKey</span><span class="java_plain">&nbsp;chavePublica&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;certificate</span><span class="java_separator">.</span><span class="java_plain">getPublicKey</span><span class="java_separator">();</span></pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1263"/>6.7. Carregar um certificado digital de um arquivo</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">CertificateLoader</span><span class="java_plain">&nbsp;certificateLoader&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CertificateLoaderImpl</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">X509Certificate</span><span class="java_plain">&nbsp;certificate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;certificateLoader</span><span class="java_separator">.</span><span class="java_plain">load</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">File</span><span class="java_separator">(</span><span class="java_literal">&quot;certificado.cer&quot;</span><span class="java_separator">);</span></pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1268"/>6.8. Carregar um certificado digital de um token</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KeyStoreLoader</span><span class="java_plain">&nbsp;keyStoreLoader&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KeyStoreLoaderFactory</span><span class="java_separator">.</span><span class="java_plain">factoryKeyStoreLoader</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">KeyStore</span><span class="java_plain">&nbsp;keyStore&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;keyStoreLoader</span><span class="java_separator">.</span><span class="java_plain">getKeyStore</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">CertificateLoader</span><span class="java_plain">&nbsp;certificateLoader&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CertificateLoaderImpl</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">certificateLoader</span><span class="java_separator">.</span><span class="java_plain">setKeyStore</span><span class="java_separator">(</span><span class="java_plain">keyStore</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">X509Certificate</span><span class="java_plain">&nbsp;certificate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;certificateLoader</span><span class="java_separator">.</span><span class="java_plain">loadFromToken</span><span class="java_separator">();</span></pre></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="policy-impl-cades-funcionalidades.html"><strong>Anterior</strong>Capítulo 5. Funcionalidades</a></li><li class="up"><a accesskey="u" href="#"><strong>Acima</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Principal</strong></a></li><li class="next"><a accesskey="n" href="policy-engine-master.html"><strong>Próxima</strong>Parte III. Policy Engine</a></li></ul></body></html>
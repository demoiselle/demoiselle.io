<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Capítulo 11. Funcionalidades</title><link rel="stylesheet" href="css/demoiselleframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Demoiselle Signer"/><link rel="up" href="timestamp-master.html" title="Parte V. TimeStamp - Carimbo de tempo"/><link rel="prev" href="timestamp-configuracao.html" title="Capítulo 10. Configuração do TimeStamp"/><link rel="next" href="cryptography-master.html" title="Parte VI. Demoiselle Signer Cryptography"/><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p id="title"><a href="http://www.frameworkdemoiselle.gov.br" class="site_href"><strong>FrameworkDemoiselle.gov.br</strong></a><a href="http://www.frameworkdemoiselle.gov.br" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="timestamp-configuracao.html"><strong>Anterior</strong></a></li><li class="next"><a accesskey="n" href="cryptography-master.html"><strong>Próxima</strong></a></li></ul><div class="chapter" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="timestamp-funcionalidades"/>Capítulo 11. Funcionalidades</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="timestamp-funcionalidades.html#requisicao">11.1. Carimbo de tempo com componente policy-impl-cades</a></span></dt><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2773">11.2. Requisições de carimbo de tempo</a></span></dt><dd><dl><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2778">11.2.1. Para uma assinatura padrão CADES</a></span></dt><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2787">11.2.2. Para um conteúdo</a></span></dt><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2803">11.2.3. Para o resumo (hash) de um conteúdo</a></span></dt></dl></dd><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2812">11.3. Validdação do Carimbo de tempo com componente policy-impl-cades</a></span></dt><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2823">11.4. Validações de carimbo de tempo</a></span></dt><dd><dl><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2828">11.4.1. Para uma assinatura padrão CADES</a></span></dt><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2835">11.4.2. Para um conteúdo</a></span></dt><dt><span class="section"><a href="timestamp-funcionalidades.html#d0e2844">11.4.3. Para o resumo (hash) de um conteúdo</a></span></dt></dl></dd></dl></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="requisicao"/>11.1. Carimbo de tempo com componente <span class="emphasis"><em>policy-impl-cades</em></span></h2></div></div></div><p>O código abaixo demostra como pode ser feita a chamada:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">PKCS7Signer</span><span class="java_plain">&nbsp;signer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PKCS7Factory</span><span class="java_separator">.</span><span class="java_plain">getInstance</span><span class="java_separator">().</span><span class="java_plain">factoryDefault</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signer</span><span class="java_separator">.</span><span class="java_plain">setCertificates</span><span class="java_separator">(</span><span class="java_type">CertificateChain</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signer</span><span class="java_separator">.</span><span class="java_plain">setPrivateKey</span><span class="java_separator">(</span><span class="java_type">PrivateKey</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;com&nbsp;carimbo&nbsp;de&nbsp;tempo</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signer</span><span class="java_separator">.</span><span class="java_plain">setSignaturePolicy</span><span class="java_separator">(</span><span class="java_type">PolicyFactory</span><span class="java_separator">.</span><span class="java_type">Policies</span><span class="java_separator">.</span><span class="java_plain">AD_RT_CADES_2_2</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Assinatura</span><span class="java_plain">&nbsp;desatachada</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;signature&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;signer</span><span class="java_separator">.</span><span class="java_plain">doDetachedSign</span><span class="java_separator">(</span><span class="java_plain">fileToSign</span><span class="java_separator">);</span>
</pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2773"/>11.2. Requisições de carimbo de tempo</h2></div></div></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2778"/>11.2.1. Para uma assinatura padrão CADES</h3></div></div></div><p>Para obter um carimbo de tempo para uma assinatura CADeS, basta enviar o conteúdo da assinatura.
		O retorno será a assinatura com o carimbo embutido, veja no exemplo abaixo:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileSignatureDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo_da_assinatura&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;signatureFile&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileSignatureDirName</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;implementar&nbsp;o&nbsp;m�todo&nbsp;de&nbsp;leitura&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;arquivo</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">setCertificates</span><span class="java_separator">(</span><span class="java_type">CertificateChain</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">setPrivateKey</span><span class="java_separator">(</span><span class="java_type">PrivateKey</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;signatureWithTimeStamp&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">doTimeStampForSignature</span><span class="java_separator">(</span><span class="java_plain">signatureFile</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
</pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2787"/>11.2.2. Para um conteúdo</h3></div></div></div><p>É possível também obter o carimbo para o conteúdo de uma informação. Neste caso o carimbo não estará associado à assinatura</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Nota</h2>A ICP-Brasil não traz nenhuma norma relativa a este tipo de carimbo, o que existe são as política para assinatura.</div><p>O código abaixo demosntra como é feita a requisição.
		O retorno é o arquivo do tipo TimeStampToken descrito na <a class="ulink" href="https://www.ietf.org/rfc/rfc3161.txt">RFC 3161</a> </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo_para_carimbar&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;content&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileDirName</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;implementar&nbsp;m�todo&nbsp;para&nbsp;leitura&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;conte�</span><span class="java_keyword">do</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">setCertificates</span><span class="java_separator">(</span><span class="java_type">CertificateChain</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">setPrivateKey</span><span class="java_separator">(</span><span class="java_type">PrivateKey</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;timeStampForContent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">doTimeStampForContent</span><span class="java_separator">(</span><span class="java_plain">content</span><span class="java_separator">);</span>
</pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2803"/>11.2.3. Para o resumo (hash) de um conteúdo</h3></div></div></div><p>A outra funcionalidade disponível permite enviar o resumo já calculado.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;content&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileDirName</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;implementar&nbsp;metodo&nbsp;para&nbsp;leitura&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;arquivo</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;gera&nbsp;o&nbsp;hash&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;conteudo</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">security</span><span class="java_separator">.</span><span class="java_type">MessageDigest</span><span class="java_plain">&nbsp;md&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">security</span><span class="java_separator">.</span><span class="java_type">MessageDigest</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getInstance</span><span class="java_separator">(</span><span class="java_type">DigestAlgorithmEnum</span><span class="java_separator">.</span><span class="java_plain">SHA_256</span><span class="java_separator">.</span><span class="java_plain">getAlgorithm</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;hash&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;md</span><span class="java_separator">.</span><span class="java_plain">digest</span><span class="java_separator">(</span><span class="java_plain">content</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">setCertificates</span><span class="java_separator">(</span><span class="java_type">CertificateChain</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">setPrivateKey</span><span class="java_separator">(</span><span class="java_type">PrivateKey</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;timeStampForContent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">doTimeStampFromHashContent</span><span class="java_separator">(</span><span class="java_plain">hash</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
</pre></div></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2812"/>11.3. Validdação do Carimbo de tempo com componente <span class="emphasis"><em>policy-impl-cades</em></span></h2></div></div></div><p>Veja a sessão de <a class="link" href="policy-impl-cades-funcionalidades.html#policy-impl-cades-funcionalidades-validar" title="5.6. Validação de assinatura PKCS7 sem o conteúdo anexado (dettached)">Validação</a></p></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2823"/>11.4. Validações de carimbo de tempo</h2></div></div></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2828"/>11.4.1. Para uma assinatura padrão CADES</h3></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileSignatureDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo_da_assinatura&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;signatureFile&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileSignatureDirName</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Timestamp</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;listTimeStamp&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">checkTimeStampOnSignature</span><span class="java_separator">(</span><span class="java_plain">signatureFile</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">listTimeStamp</span><span class="java_separator">.</span><span class="java_plain">isEmpty</span><span class="java_separator">()){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Timestamp</span><span class="java_plain">&nbsp;ts&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;listTimeStamp</span><span class="java_separator">){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">ts</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
</pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2835"/>11.4.2. Para um conteúdo</h3></div></div></div><p>Para validar o carimbo associado a um contéudo, é preciso enviar ao componente, o contéudo e a assinatura, conforme o código abaixo:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileTimeStampDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo_da_assinatura&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileContentDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo_assinado&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;timeStampFile&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileTimeStampDirName</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;content&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileContentDirName</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Timestamp</span><span class="java_plain">&nbsp;varTimeStamp&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">checkTimeStampWithContent</span><span class="java_separator">(</span><span class="java_plain">timeStampFile</span><span class="java_separator">,</span><span class="java_plain">&nbsp;content</span><span class="java_separator">);</span>
</pre></div><div class="section" lang="pt-BR"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2844"/>11.4.3. Para o resumo (hash) de um conteúdo</h3></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileTimeStampDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo_da_assinatura&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fileContentDirName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;local_e_nome_do_arquivo_assinado&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;timeStampFile&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileTimeStampDirName</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;content&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;readContent</span><span class="java_separator">(</span><span class="java_plain">fileContentDirName</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;gera&nbsp;o&nbsp;hash&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;conteudo</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">security</span><span class="java_separator">.</span><span class="java_type">MessageDigest</span><span class="java_plain">&nbsp;md&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">security</span><span class="java_separator">.</span><span class="java_type">MessageDigest</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getInstance</span><span class="java_separator">(</span><span class="java_type">DigestAlgorithmEnum</span><span class="java_separator">.</span><span class="java_plain">SHA_256</span><span class="java_separator">.</span><span class="java_plain">getAlgorithm</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">byte</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;hash&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;md</span><span class="java_separator">.</span><span class="java_plain">digest</span><span class="java_separator">(</span><span class="java_plain">content</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CAdESTimeStampSigner</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Timestamp</span><span class="java_plain">&nbsp;varTimeStamp&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;varCAdESTimeStampSigner</span><span class="java_separator">.</span><span class="java_plain">checkTimeStampWithHash</span><span class="java_separator">(</span><span class="java_plain">timeStampFile</span><span class="java_separator">,</span><span class="java_plain">&nbsp;hash</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
</pre></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="timestamp-configuracao.html"><strong>Anterior</strong>Capítulo 10. Configuração do TimeStamp</a></li><li class="up"><a accesskey="u" href="#"><strong>Acima</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Principal</strong></a></li><li class="next"><a accesskey="n" href="cryptography-master.html"><strong>Próxima</strong>Parte VI. Demoiselle Signer Cryptography</a></li></ul></body></html>